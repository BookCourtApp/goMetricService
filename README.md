# goMetricService
Сервис для сбора данных с мобильного приложения BookCourt

# Инструкция
1. Для запуска необходимо произвести экспорт переменных среды, которые содержатся в .env файле. Это можно
   сделать самостоятельно, либо при использовании утилиты direnv. 

# Архитектура

![image](https://github.com/wanna-beat-by-bit/goMetricService/assets/71206074/f526379d-0ff8-4986-9c9d-3be66a008926)

### Api
Отвечает за принятие данных извне с помощью поднятого эндпойнта, здесь происходит маппинг JSON объекта
на сущность события (Метрики)

### Service
Отвечает за работу с кэшэм и бд.

### Cache
Отвечает за хранение актуальных сессий для пользователей. Если пользователь в течение 30 минут
не был активен, сессия удаляется. Это позволяет отследить воронку событий пользователя за один
сеанс.

### Database
Отвечает за хранение событий. Была выбрана база данных, ориентированная на колонки, а не строки,
чтобы увеличить скорость поиска.

# Управление проектом
* Запуск проекта
```
make build
make run
```
* Запустить в докере
```
make dc
```
* Создать пустые миграции
```
make m-c
```

# Сложности запуска
Для работы с superset нужно создать admin пользователя для того, чтобы зайти на сайт с клиентом:
```
docker exec -it <superset_container_name> superset fab create-admin \
    --username=admin --firstname=Admin --lastname=User \
    --email=admin@example.com --password=admin
```
Для создания volume для хранения данных clickhouse нужно сначала создать папку хранения, а затем 
присвоить ей права, с помощью которых к ней из контейнера будет доступ:
```
make clickhouse-data
sudo chown 101 clickhouse-data
```
